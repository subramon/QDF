\section{Coalesce}


\begin{itemize}
  \item Let x be a read only immutable pointer to \qdf.
  \item Let y be a read only immutable pointer to \qdf.
  \item Let z be a                     pointer to \qdf.
  \item qx  :=  \getq(x)
  \item qy  :=  \getq(y)
  \item cqx := q2c[qx] 
  \item cqy := q2c[qy] 
\end{itemize}

\begin{verbatim}
T = { "coalesce", "_", qx, "_", qy }
func = string.concat(T)
\end{verbatim}

Create a function with name func specified as above 

\end{document}


jtype_t jx  := get_jtype(X)
jtype_t jy  := get_jtype(Y)
uint32_t nx := get_length(X)
uint32_t ny := get_length(Y)
// Let cqx be the C type corresponding to qx as defined in Lua table q2c
// Let cqy be the C type corresponding to qy as defined in Lua table q2c


Assume that qx == I32 and that qy == I32.
Create a function with the signature shown below, 
replacing <qx> with the value of qx and 
replacing <qy> with the value of qy 

int
coalesce_<qx>_<qy>(
    const QDF_REC_TYPE * const x,
    const QDF_REC_TYPE * const y,
    QDF_REC_TYPE * restrict z
   )
{
  int status = 0;
  // FILL IN THE BLANKS
BYE:
  return status;
}


It returns 0 if success, -1 if any failure
It takes 3 arguments: x, Y, Z 

Function fails under the conditions listed below
Fails if x == NULL
Fails if y == NULL
Fails if x == y
Fails if qx != qy
Fails if jx != j_array
Fails if jy != j_array
Fails if nx != ny
Fails if nx == 0

   const cqx * const vx = get_read_arr_ptr(x)
   const cqy * const vy = get_read_arr_ptr(y)

   Let nz := nx 
   Let jz := jx 
   Let qz := qx 
   Create vz  as an array of type cqx and length nz
   Create nnz as an array of type bool and length nz

   Execute the following for all values of i in [0 .. nz-1]

   if ( is_null(X[i] == true ) then
     if is_null(Y[i]) == true) then 
       vz[i] := 0
       nnz[i] := false
     else
       vz[i] := vy[i]
       nnz[i] := true
     endif
   else
     vz[i] := vx[i]
     nnz[i] := true
   end

  // Execute the following setter functions
  // All setters return a int status. If status is not 0, then
  // calling function executes macro cBYE(-1)
  set_jtype(z, jz)
  set_qtype(z, qz)
  set_length(z, nz)
  set_array(z, vz)
  set_nn(z, nnz)

