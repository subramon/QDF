\section{Coalesce}


\begin{itemize}
  \item Let x be a read only immutable pointer to \qdf.
  \item Let y be a read only immutable pointer to \qdf.
  \item Let z be a                     pointer to \qdf.
  \item qx  :=  \getq(x)
  \item qy  :=  \getq(y)
  \item cqx := q2c[qx] C type corresponding to qx as defined in Lua table q2c
  \item cqy := q2c[qy] C type corresponding to qy as defined in Lua table q2c
\item jx  := \getj(X)
\item jy  := \getj(Y)
\item nx := \getn(X)
\item ny := \getn(Y)
\item const cqx * const vx = \getrv(x)
\item const cqy * const vy = \getrv(y)
\item const bool * const nnx = \getnn(x)
\item const bool * const nny = \getnn(y)
\end{itemize}

\begin{verbatim}
T = { "coalesce", "_", qx, "_", qy }
func = string.concat(T)
\end{verbatim}

Function signature is 
\begin{enumerate}
  \item name is func, specified above. 
  \item Return value is of type integer. 
    Return value is 0 on success, -1 on failure.
  \item Arguments are x, y, z specified above
\end{enumerate}

Function logic is as follows.

Function fails under the conditions listed below
\be
\item Fails if x == NULL
\item Fails if y == NULL
\item Fails if x == y
\item Fails if qx \(\neq\) qy
\item Fails if jx \(\neq \jarr\) 
\item Fails if jy \(\neq \jarr\) 
\item Fails if nx \(\neq\) ny
\item Fails if nx == 0
  \ee


   Let nz := nx 
   Let jz := jx 
   Let qz := qx 
   Create vz  as an array of type cqx and length nz
   Create nnz as an array of type bool and length nz

   Execute the following for all values of i in [0 .. nz-1]

   if ( not nnx == or nnx[i] ) then 
     vz[i] := vx[i]
     nnz[i] := true
   else
     if ( not nny == or nny[i] ) then 
       vz[i] := vy[i]
       nnz[i] := true
     else
       vz[i] := 0
       nnz[i] := false
     endif
   endif

  // Execute the following setter functions
  // All setters return a int status. If status is not 0, then
  // calling function executes macro cBYE(-1)
  \begin{enumerate}
    \item   \setj(z, jz)
    \item   \setq(z, qz)
    \item   \setn(z, nz)
    \item   \setv(z, vz)
    \item   \setnn(z, nnz)
  \end{enumerate}

\end{document}
